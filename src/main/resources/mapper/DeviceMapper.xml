<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ct.websocket.mapper.DeviceMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.ct.websocket.entity.Device">
        <id column="id" property="id" />
        <result column="name" property="name" />
        <result column="device_id" property="deviceId" />
        <result column="communication_protocol" property="communicationProtocol" />
        <result column="acquisition_frequency" property="acquisitionFrequency" />
        <result column="type" property="type" />
        <result column="status" property="status" />
        <result column="project_id" property="projectId" />
        <result column="tsl_key" property="tslKey" />
        <result column="longitude" property="longitude" />
        <result column="latitude" property="latitude" />
        <result column="create_time" property="createTime" />
        <result column="create_by" property="createBy" />
        <result column="update_time" property="updateTime" />
        <result column="update_by" property="updateBy" />
        <result column="test1" property="test1" />
        <result column="test2" property="test2" />
        <result column="test3" property="test3" />
        <result column="test4" property="test4" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, name, device_id, communication_protocol, acquisition_frequency, type, status, project_id, tsl_key, longitude, latitude, create_time, create_by, update_time, update_by, test1, test2, test3, test4
    </sql>

    <select id="getAllDeviceByRole" resultType="com.ct.websocket.entity.vo.DeviceVO">
        select d.name as deviceName, d.device_id, d.status, p.name as projectName
        from device d
        inner join project p on d.project_id = p.id
        inner join sys_role_project srp on srp.project_id = p.id
        inner join sys_role sr on sr.id = srp.role_id
        where sr.role_name = #{roleName}
    </select>
</mapper>
